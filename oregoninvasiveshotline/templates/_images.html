{% load django_bootstrap5 %}

<fieldset id="images">
    <legend>Images</legend>
    <p>
      <em>
        To add photos, click the button below and browse for the image on your computer.
        You can add multiple pictures by clicking the "Add Another Image" link.
        Please note that images uploaded may be publicly accessible under
        <a href="https://wellcome.org/grant-funding/guidance/open-access-guidance/creative-commons-attribution-licence-cc">CC-BY</a>
        licensing guidelines.
      </em>
    </p>
    <p class="alert alert-info">The total size of your images when uploading must not exceed 16MB.</p>
    <div class="formset">
        {{ formset.management_form }}
        <!-- the first form yielded is the empty form. We use that as a template for the JS, so make it hidden -->
        <div class="formset">
            {% for subform in formset.iter_with_empty_form_first %}
            <div class="formset-row d-flex flex-wrap flex-md-nowrap gap-1 gap-md-3"
                 {% if forloop.counter0 == 0 %}style="display: none !important;"{% endif %}>
            
                <!-- Image upload and delete button in one row on mobile -->
                <div class="d-flex flex-row gap-1 justify-content-between flex-grow-1 flex-md-grow-0">
                    <div class="formset-image">
                        {% if subform.image.errors %}
                            <div class="text-danger">
                                {{ subform.image.errors }}
                            </div>
                        {% endif %}
                        {% if not subform.image.value %}
                            <span class="preview"></span>
                        {% endif %}
                        {% bootstrap_field subform.image label_class="visually-hidden" %}
                    </div>
            
                    <div class="formset-delete d-flex flex-column justify-content-start">
                        {{ subform.image_id }}
                        {% bootstrap_field subform.DELETE %}
                    </div>
                </div>
            
                <!-- Name (caption) field full width on mobile, inline on desktop -->
                <div class="formset-name flex-grow-1 w-100 w-md-auto">
                    {% bootstrap_field subform.name %}
                </div>
            
                <!-- Optional visibility field -->
                {% if subform.visibility %}
                    <div class="formset-visibility">
                        {% bootstrap_field subform.visibility %}
                    </div>
                {% endif %}
            
            </div>
            {% endfor %}
        </div>

        <a href="#" class="formset-adder">Add Another Image</a>
    </div>
</fieldset>
