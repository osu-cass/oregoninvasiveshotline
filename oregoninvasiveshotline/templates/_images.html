{% load django_bootstrap5 %}

<fieldset id="images">
    <legend>Images</legend>
    <p>
      <em>
        To add photos, click the button below and browse for the image on your computer.
        You can add multiple pictures by clicking the "Add Another Image" link.
        Please note that images uploaded may be publicly accessible under
        <a href="https://wellcome.org/grant-funding/guidance/open-access-guidance/creative-commons-attribution-licence-cc">CC-BY</a>
        licensing guidelines.
      </em>
    </p>
    <p class="alert alert-info">The total size of your images when uploading must not exceed 16MB.</p>
    <div class="formset">
        {{ formset.management_form }}
        <!-- the first form yielded is the empty form. We use that as a template for the JS, so make it hidden -->
        <div class="formset">
            {% for subform in formset.iter_with_empty_form_first %}
                <div class="formset-row d-flex gap-3 align-items-start"
                    {% if forloop.counter0 == 0 %}style="display:none"{% endif %}>
                    
                    <div class="formset-image">
                        {% if subform.image.errors %}
                            <div class="text-danger">
                                {{ subform.image.errors }}
                            </div>
                        {% endif %}
                        {% if not subform.image.value %}
                            <span class="preview"></span>
                        {% endif %}
                        {% bootstrap_field subform.image label_class="visually-hidden" %}
                    </div>

                    <div class="formset-name flex-grow-1">
                        {% bootstrap_field subform.name %}
                    </div>

                    {% if subform.visibility %}
                        <div class="formset-visibility">
                            {% bootstrap_field subform.visibility %}
                        </div>
                    {% endif %}

                    <div class="formset-delete">
                        {{ subform.image_id }}
                        {% bootstrap_field subform.DELETE %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <a href="#" class="formset-adder">Add Another Image</a>
    </div>
</fieldset>
